---
- op: add
  path: /spec/resources/-1
  value:
    name: istio-base
    base:
      apiVersion: helm.crossplane.io/v1beta1
      kind: Release
      metadata:
        annotations: 
          crossplane.io/external-name: istio-base
      spec:
        forProvider:
          chart:
            name: base
            repository: https://istio-release.storage.googleapis.com/charts
            version: 1.13.2
          namespace: istio-system
          wait: true
        rollbackLimit: 5
    patches:
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: spec.providerConfigRef.name
      transforms:
      - type: string
        string:
          fmt: "%s-cluster"
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: metadata.name
      transforms:
      - type: string
        string:
          fmt: "%s-istio-base"

- op: add
  path: /spec/resources/-1
  value:
    name: istiod
    base:
      apiVersion: helm.crossplane.io/v1beta1
      kind: Release
      metadata:
        annotations: 
          crossplane.io/external-name: istiod
      spec:
        forProvider:
          chart:
            name: istiod
            repository: https://istio-release.storage.googleapis.com/charts
            version: 1.13.2
          skipCreateNamespace: true
          namespace: istio-system
          wait: true
        rollbackLimit: 5
    patches:
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: spec.providerConfigRef.name
      transforms:
      - type: string
        string:
          fmt: "%s-cluster"
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: metadata.name
      transforms:
      - type: string
        string:
          fmt: "%s-istiod"

- op: add
  path: /spec/resources/-1
  value:
    name: istio-ingress
    base:
      apiVersion: helm.crossplane.io/v1beta1
      kind: Release
      metadata:
        annotations: 
          crossplane.io/external-name: istio-ingress
      spec:
        forProvider:
          chart:
            name: gateway
            repository: https://istio-release.storage.googleapis.com/charts
            version: 1.13.2
          namespace: istio-ingress
          wait: true
        rollbackLimit: 5
    patches:
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: spec.providerConfigRef.name
      transforms:
      - type: string
        string:
          fmt: "%s-cluster"
    - type: FromCompositeFieldPath
      fromFieldPath: metadata.name
      toFieldPath: metadata.name
      transforms:
      - type: string
        string:
          fmt: "%s-istio-ingress"